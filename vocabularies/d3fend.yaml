domain_range_relations:
  sparql: |-
    CONSTRUCT {
        ?object ?rel ?subject
    }
    WHERE {
        OPTIONAL {
        ?rel rdfs:domain ?object;
            rdfs:range   ?subject
        .
        }
        OPTIONAL {
            ?object rdfs:subClassOf [
            a owl:Restriction;
            owl:onProperty ?rel;
            owl:someValuesFrom ?subject
            ]
        }
    FILTER (
        regex(str(?subject), "http://d3fend.mitre.org", "i")
    )
    }
attach_defend_things:
  sparql: |-
    SELECT DISTINCT
        ?parent ?entity
    WHERE {
        ?sub rdfs:subClassOf ?class ;
        rdfs:label ?entity
        .
        ?class rdfs:label ?parent
        VALUES (?class) {
            (d3f:D3FENDThing)
            (d3f:ATTACKThing)
        }
    }
    ORDER BY (?parent)

offensice_techniques:
  description: |-
    d3f:enable associates Offensive techniques and tactics.
  sparql: |-

    SELECT DISTINCT ?attack, ?tactic
    WHERE {

    ?attack_u
        (rdf:type|rdfs:subClassOf)* d3f:OffensiveTechnique;
        rdfs:label ?attack;
        d3f:enables ?tactic_u
    .
    ?tactic_u   (rdf:type|rdfs:subClassOf)* d3f:OffensiveTactic;
        rdfs:label ?tactic

    }

owl_restrictions:
  sparql: |-
    CONSTRUCT {
        ?object ?rel ?subject
    }
    WHERE {

      ?object rdfs:subClassOf [
            a owl:Restriction;
            owl:onProperty ?rel;
            owl:someValuesFrom ?subject
            ]
    . ?object (rdf:type|rdfs:subClassOf)* d3f:D3FENDThing

    FILTER (
    regex(str(?subject), "http://d3fend.mitre.org", "i")
    )
    }

artifact_to_offensive:
  description: |-
    --------------------------------------------------------------------------------
    query generated by function: artifact_to_offensive
    ----------------------------------------

    # Interactive parameterized version of
    # digital artifact (offensive) -> defensive and offensive techniques
    #
    # Does not match subtechnique which have no artifact specs
    # In such a case it will only match the parent technique, reducing information
    # overload.

  sparql: |-

    PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
    PREFIX owl: <http://www.w3.org/2002/07/owl#>
    PREFIX d3f: <http://d3fend.mitre.org/ontologies/d3fend.owl#>

    SELECT DISTINCT

        ?off_artifact_label
        ?off_artifact_rel_label
        ?off_tech_label
        ?off_tech_id
        ?off_tactic_rel_label
        ?off_tactic_label

        ?off_artifact
        ?off_artifact_rel
        ?off_tech
        ?off_tactic_rel
        ?off_tactic

    WHERE {



        ?genl_off_tech
            rdfs:subClassOf+ d3f:OffensiveTechnique ;
            ?off_tactic_rel ?off_tactic .
        ?off_tactic
            rdfs:subClassOf+ d3f:OffensiveTactic ;
            rdfs:label ?off_tactic_label .

        ?off_tech
            rdfs:subClassOf* ?genl_off_tech ;
            d3f:attack-id ?off_tech_id ;
            rdfs:label ?off_tech_label ;
            ?off_artifact_rel ?off_artifact ;

        ?off_artifact
            rdfs:subClassOf* d3f:ServiceApplication ;
            rdfs:label ?off_artifact_label .

        ?off_artifact_rel rdfs:label ?off_artifact_rel_label .
        ?off_tactic_rel rdfs:label ?off_tactic_rel_label .

    }

    ORDER BY ?off_artifact_label
